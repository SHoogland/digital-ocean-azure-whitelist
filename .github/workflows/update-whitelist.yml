name: Update digital ocean firewall whitelist

on:
  push:
    branches: master
  schedule:
  - cron: "0 0 * * *"

jobs:
  update:

    runs-on: ubuntu-latest

    steps:
    - name: Update whitelist
      uses: digitalocean/action-doctl@v1
      env:
        DIGITALOCEAN_ACCESS_TOKEN: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}
      with:
        args: compute firewall update 02f5cd35-294e-4afa-a474-98afd4afb245 --name azure-cloud --inbound-rules protocol:tcp,ports:22,address:$(dig +short myip.opendns.com @resolver1.opendns.com)	
